<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ecosystème logistique:  Fichier source de src/clusterizer/clusterizer.py</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ecosystème logistique
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Généré par Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Recherche','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Recherche');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_ec13a877a3c163706f93bc56ff2b1e27.html">clusterizer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">clusterizer.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="clusterizer_8py.html">Aller à la documentation de ce fichier.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html">    1</a></span>&#160;<span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> typing <span class="keyword">import</span> List, Tuple</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> geopandas <span class="keyword">as</span> gpd</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">import</span> folium</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">import</span> time</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool, Process, Array, RawArray</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">import</span> cProfile</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">import</span> sys</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;sys.path.append(<span class="stringliteral">&quot;../../&quot;</span>)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans, MiniBatchKMeans</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">from</span> shapely.geometry <span class="keyword">import</span> Polygon</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">from</span> src.clusterizer.utils <span class="keyword">import</span> NAF_utils</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">from</span> src.clusterizer.utils <span class="keyword">import</span> clusterizer_utils</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">from</span> src.clusterizer.utils.clusterizer_utils <span class="keyword">import</span> COLUMN_HULLS_NAME, \</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    COLUMN_CLUSTER_INDEX_NAME, \</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    COLUMN_CLUSTER_SIZE_NAME, \</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    COLUMN_CENTROIDS_NAME, \</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    COLUMN_DEFAULT_GEOMETRY_NAME, \</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    COLUMN_CLUSTER_MASS_NAME</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">from</span> src.clusterizer.seine_data_utils <span class="keyword">import</span> Frontiere, get_frontieres_utiles, Point</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="stringliteral">Clusterise en utilisant l&#39;algorithme des k-moyennes.</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a542f5de9409b4069e9a09942141e50cf">   37</a></span>&#160;DEBUG_PLOT = <span class="keyword">False</span> <span class="comment"># pour afficher les points et frontières (debugging)</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;f_seine_nord, \</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;f_seine_ouest, \</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;f_seine_petit_droite, \</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;f_seine_petit_gauche, \</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;f_seine_central, \</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;f_seine_alfort_1_gauche,\</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;f_seine_alfort_2_droite,\</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;f_seine_alfort_3_gauche,\</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;f_marne,\</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;= <a class="code" href="namespaceseine__data__utils__py.html#a903d42f6fbfa65c2be4ca663bb932caf">get_frontieres_utiles</a>()</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">@np.vectorize</span></div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a1842efc97d44e8e752733c4d063f523a">   52</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#a1842efc97d44e8e752733c4d063f523a">rapport_a_la_seine</a>(xy):</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="stringliteral">    TODO</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="stringliteral">    :param xy:</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="stringliteral">    :return:</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    point_etudie = Point(xy[0], xy[1])</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment"># try:</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">#     f_seine_ouest.en_dessous(point_etudie)</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment"># except Frontiere.DansLaFrontiereNotError as e:</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">#     if e.res:</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">#         return 0</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">if</span> f_seine_ouest.en_dessous(point_etudie):</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordflow">if</span> DEBUG_PLOT:</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                point_etudie.plot(<span class="stringliteral">&quot;red&quot;</span>)</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            <span class="keywordflow">return</span> 0</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">except</span> Frontiere.HorsDeLaFrontiereError:</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment"># try:</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">#     f_seine_central.en_dessous(point_etudie)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment"># except Frontiere.DansLaFrontiereNotError as e:</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">#     if e.res:</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">#         return 1</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span> f_seine_central.en_dessous(point_etudie) :</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="keywordflow">if</span> DEBUG_PLOT:</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                point_etudie.plot(<span class="stringliteral">&quot;green&quot;</span>)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keywordflow">return</span> 1</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">except</span> Frontiere.HorsDeLaFrontiereError:</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment"># try:</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">#     f_marne.en_dessous(point_etudie)</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment"># except Frontiere.DansLaFrontiereNotError as e:</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">#     if e.res:</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">#         return 1</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span> f_marne.en_dessous(point_etudie) :</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="keywordflow">if</span> DEBUG_PLOT:</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                point_etudie.plot(<span class="stringliteral">&quot;green&quot;</span>)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">return</span> 1</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">except</span> Frontiere.HorsDeLaFrontiereError:</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment"># try:</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">#     f_seine_central.en_dessous(point_etudie)</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment"># except Frontiere.DansLaFrontiereNotError as e:</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">#     if not e.res:</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">#         return 2</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> f_seine_central.en_dessous(point_etudie):</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordflow">if</span> DEBUG_PLOT:</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                point_etudie.plot(<span class="stringliteral">&quot;blue&quot;</span>)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keywordflow">return</span> 2</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">except</span> Frontiere.HorsDeLaFrontiereError:</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment"># try:</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">#     f_seine_alfort_1_gauche.en_dessous(point_etudie)</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment"># except Frontiere.DansLaFrontiereNotError as e:</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">#     if e.res:</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">#         return 2</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span> f_seine_alfort_1_gauche.en_dessous(point_etudie):</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordflow">if</span> DEBUG_PLOT:</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                point_etudie.plot(<span class="stringliteral">&quot;blue&quot;</span>)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="keywordflow">return</span> 2</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">except</span> Frontiere.HorsDeLaFrontiereError:</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment"># try:</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">#     f_seine_alfort_2_droite.en_dessous(point_etudie)</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment"># except Frontiere.DansLaFrontiereNotError as e:</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">#     if e.res:</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">#         return 2</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span> f_seine_alfort_2_droite.en_dessous(point_etudie):</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="keywordflow">if</span> DEBUG_PLOT:</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                point_etudie.plot(<span class="stringliteral">&quot;blue&quot;</span>)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="keywordflow">return</span> 2</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">except</span> Frontiere.HorsDeLaFrontiereError:</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> DEBUG_PLOT:</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        point_etudie.plot(<span class="stringliteral">&quot;black&quot;</span>)</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">return</span> 3</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a46c1c161d2d1f3c4da2b499b8b4077d8">  144</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#a46c1c161d2d1f3c4da2b499b8b4077d8">process_rapport_a_la_seine</a>(no_zone:int, df: pd.DataFrame, shared_array: Array) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="stringliteral">    TODO</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="stringliteral">    :param no_zone:</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="stringliteral">    :param df:</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="stringliteral">    :param shared_array:</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    shared_array[no_zone] = df[no_zone == <a class="code" href="namespaceclusterizer.html#a1842efc97d44e8e752733c4d063f523a">rapport_a_la_seine</a>(np.array(df.copy()[<span class="stringliteral">&quot;geometry&quot;</span>].apply(<span class="keyword">lambda</span> x: x[<span class="stringliteral">&#39;coordinates&#39;</span>])))].reset_index(drop=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#ada962bb8f1ec417142e11c0ca8cca63a">  154</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#ada962bb8f1ec417142e11c0ca8cca63a">map_rapport_a_la_seine</a>(args_tuple: Tuple[int, pd.DataFrame]) -&gt; pd.DataFrame:</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">    TODO</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="stringliteral">    :param args_tuple:</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">    :return:</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    no_zone, df = args_tuple</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">return</span> df[no_zone == <a class="code" href="namespaceclusterizer.html#a1842efc97d44e8e752733c4d063f523a">rapport_a_la_seine</a>(np.array(df.copy()[<span class="stringliteral">&quot;geometry&quot;</span>].apply(<span class="keyword">lambda</span> x: x[<span class="stringliteral">&#39;coordinates&#39;</span>])))].reset_index(drop=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#aeec4083b19ab1b2b6b1dece87329556d">  166</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#aeec4083b19ab1b2b6b1dece87329556d">nettoyer</a>(df: pd.DataFrame, reduce: bool = <span class="keyword">False</span>, threshold: int = 1000, column_geometry: str = COLUMN_DEFAULT_GEOMETRY_NAME) -&gt; pd.DataFrame:</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="stringliteral">    Nettoie la DataFrame. Enlève les na.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="stringliteral">    Si spécifié, ne retient que les premières données de la DataFrame.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="stringliteral">    :param df: La DataFrame.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="stringliteral">    :param reduce: Si True, ne prend que les premières données.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="stringliteral">    :param threshold: Dans le cas où reduce=True, nombre de données à sélectionner.</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="stringliteral">    :param column_geometry: A spécifier si la colonne contenant les points n&#39;est pas la colonne par défaut (&quot;geometry&quot;)</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="stringliteral">    :return: Une DataFrame nettoyée.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span> reduce <span class="keywordflow">and</span> df.size &gt;= threshold:</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        df = df[:threshold]</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">return</span> df.dropna(subset=[column_geometry]).reset_index(drop=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a3af79889960331fc4392936526bc8ad6">  186</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#a3af79889960331fc4392936526bc8ad6">clusterize</a>(df: pd.DataFrame, k: int, column_geometry: str = COLUMN_DEFAULT_GEOMETRY_NAME, is_dict: bool = <span class="keyword">False</span>, weight: bool = <span class="keyword">True</span>) -&gt; Tuple[pd.DataFrame, pd.DataFrame]:</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="stringliteral">    Clusterise à l&#39;aide de l&#39;algorithme des k-moyennes. Attention, fait du en-place.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="stringliteral">    :param df: La (Geo)DataFrame contenant les points à clusteriser.</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="stringliteral">    :param k: Le nombre de clusters à calculer.</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="stringliteral">    :param column_geometry: A spécifier si la colonne contenant les points n&#39;est pas la colonne par défaut (&quot;geometry&quot;)</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="stringliteral">    :param is_dict: Indiquer True si jamais la colonne contenant les points ne contient pas d&#39;objets</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="stringliteral">     shapely.geometry.Points, mais un dictionnaire (en général, lorsque le fichier provient d&#39;un GeoJSON)</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="stringliteral">    :return: Deux GeoDataFrame.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="stringliteral">     Une première GeoDataFrame entrée contenant une colonne en plus (&quot;cluster&quot;) : celle-ci permet de savoir pour chaque</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="stringliteral">     point le numéro du cluster qui lui a été affecté.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="stringliteral">     Une deuxième GeoDataFrame contenant les informations détaillées de chaque cluster : centre de masse (&quot;centroids&quot;),</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="stringliteral">     enveloppe convexe (&quot;hulls&quot;) et nombre d&#39;établissements dans le cluster (&quot;taille&quot;)</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment"># ===========================================================</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment"># Commençons par faire le clustering et récupérer les centres</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment"># ==========================================================</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment"># kmeans = KMeans(n_clusters=k, random_state=0)</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    mbk = MiniBatchKMeans(n_clusters=k, random_state=0, batch_size=2048)  <span class="comment"># ça va plus vite</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment"># Ceci contient des coordonnées (x, y) des points</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    X = <a class="code" href="namespaceclusterizer__utils.html#a4aab52450ec0e5c333c03f2cfa4694e2">clusterizer_utils.get_coords_from_object</a>(df, column_geometry, is_dict)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> len(X) &lt; 1:</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;Table vide&quot;</span>)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    Y = <a class="code" href="namespaceclusterizer__utils.html#affa7c2c6862dc269e97b6b0bfa95a4da">clusterizer_utils.vectorized_calculer_poids_code_NAF</a>(df[<span class="stringliteral">&quot;apet700&quot;</span>]) <span class="keywordflow">if</span> weight <span class="keywordflow">else</span> <span class="keywordtype">None</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment"># On ajoute à la DataFrame originale les numéros de cluster pour chaque point.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    df_point_cluster = gpd.GeoDataFrame(mbk.fit_predict(X, sample_weight=Y), columns=[COLUMN_CLUSTER_INDEX_NAME], dtype=int)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    df = df.join(df_point_cluster)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment"># La DataFrame &quot;df_infos_clusters&quot; associe à chaque numéro de cluster les informations correspondantes.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment"># En détails : une colonne &quot;centroids&quot; (centres de masse), une colonne &quot;hulls&quot; (enveloppes convexes),</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment"># une colonne &quot;taille&quot; (nombre d&#39;établissements)</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    df_infos_clusters = pd.DataFrame(gpd.points_from_xy(mbk.cluster_centers_[:, 0],</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                                        mbk.cluster_centers_[:, 1]),</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                     columns=[COLUMN_CENTROIDS_NAME]</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                     )</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    df_infos_clusters = df_infos_clusters.join(<a class="code" href="namespaceclusterizer__utils.html#a1a09a2a4d0cb4435e9341da24dde35df">clusterizer_utils.get_infos_clusters_taille</a>(df))</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    df_infos_clusters = df_infos_clusters.join(</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <a class="code" href="namespaceclusterizer__utils.html#a67d3497ffce20f00b8670186e255a548">clusterizer_utils.get_infos_clusters_enveloppes_convexes</a>(k, df, column_geometry, is_dict))</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    df_infos_clusters = df_infos_clusters.join(<a class="code" href="namespaceclusterizer__utils.html#a5788fa8785e88a80e5a1e584c04ec05b">clusterizer_utils.get_infos_clusters_poids</a>(df, <span class="stringliteral">&quot;apet700&quot;</span>))</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">return</span> df, df_infos_clusters</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a3347b353b00237f8b17fd025f019c50f">  235</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#a3347b353b00237f8b17fd025f019c50f">save_to_map</a>(df_clusters: pd.DataFrame, map: folium.folium.Map = <span class="keywordtype">None</span>) -&gt; folium.folium.Map:</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="stringliteral">    Sauvegarde les informations des clusters dans une carte Leaflet.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="stringliteral">    Retourne la carte</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="stringliteral">    :param df_clusters: La DataFrame contenant les informations de chaque cluster</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="stringliteral">     (cf. deuxième sortie de la fonction clusterize)</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="stringliteral">    :param map: la carte à utiliser</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="stringliteral">     si un paramètre est spécifié : réecrit par dessus.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="stringliteral">     si rien n&#39;est spécifié, génère une nouvelle carte</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="stringliteral">    :return une carte complétée.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">if</span> map <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        map = folium.Map(location=[48.844952, 2.339193],</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                        zoom_start=10,</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                        tiles=<span class="stringliteral">&quot;Stamen Terrain&quot;</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        )</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    couleurs = [<span class="stringliteral">&#39;darkslateblue&#39;</span>, <span class="stringliteral">&#39;orange&#39;</span>, <span class="stringliteral">&#39;darkred&#39;</span>, <span class="stringliteral">&#39;black&#39;</span>,</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="stringliteral">&#39;purple&#39;</span>, <span class="stringliteral">&#39;deeppink&#39;</span>, <span class="stringliteral">&#39;green&#39;</span>, <span class="stringliteral">&#39;darkgreen&#39;</span>, <span class="stringliteral">&#39;maroon&#39;</span>,</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="stringliteral">&#39;darkblue&#39;</span>, <span class="stringliteral">&#39;chocolate&#39;</span>, <span class="stringliteral">&#39;blue&#39;</span>, <span class="stringliteral">&#39;red&#39;</span>]</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    centroids = df_clusters.loc[:, COLUMN_CENTROIDS_NAME]</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    hulls = df_clusters.loc[:, COLUMN_HULLS_NAME]</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    sizes = df_clusters.loc[:, COLUMN_CLUSTER_SIZE_NAME]</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    poids = df_clusters.loc[:, COLUMN_CLUSTER_MASS_NAME]</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">for</span> k, point <span class="keywordflow">in</span> enumerate(centroids):</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">if</span> point <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            title = f<span class="stringliteral">&quot;Centre de masse du cluster {k} : {sizes[k]} établissements. Poids : {poids[k]}&quot;</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            folium.CircleMarker(location=[point.y, point.x],</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                          popup=title,</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                          radius=1</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                         <span class="comment"># icon=folium.Icon(color=couleurs[k % len(couleurs)], icon=&#39;info-sign&#39;)</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                          ).add_to(map)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">for</span> k, polygon <span class="keywordflow">in</span> enumerate(hulls):</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        title = f<span class="stringliteral">&quot;Cluster {k}&quot;</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">if</span> type(polygon) == Polygon:</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="comment"># Notre cluster a plus de trois points (autrement, le type serait Point ou LineString)</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="comment"># Donc c&#39;est utile d&#39;afficher l&#39;enveloppe convexe</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            polygon = <a class="code" href="namespaceclusterizer__utils.html#ab8828a4ec46c57e4c2fbcea7c314bb38">clusterizer_utils.swap_xy</a>(polygon)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            coords = polygon.exterior.coords</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            folium.Polygon(locations=coords, popup=title, color=couleurs[k % len(couleurs)]).add_to(map)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    map.get_root().html.add_child(</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        folium.Element(str(</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="stringliteral">&quot;&lt;title&gt;&quot;</span> + str(len(hulls)) + <span class="stringliteral">&quot; clusters&lt;/title&gt;&quot;</span>))</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    )</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">return</span> map</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a786e8ab3d593d24c6ddf8cdb68f93d2b">  289</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#a786e8ab3d593d24c6ddf8cdb68f93d2b">test_geojson</a>():</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="stringliteral">    Fonction interne (utilisée pour vérifier le bon fonctionnement de la clusterisation).</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    df = <a class="code" href="namespaceclusterizer.html#aeec4083b19ab1b2b6b1dece87329556d">nettoyer</a>(gpd.read_file(<span class="stringliteral">&quot;../../essais/gis/input/reducted.geojson&quot;</span>))</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    df, df_clusters = <a class="code" href="namespaceclusterizer.html#a3af79889960331fc4392936526bc8ad6">clusterize</a>(df, 10, is_dict=<span class="keyword">False</span>)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="namespaceclusterizer.html#a3347b353b00237f8b17fd025f019c50f">save_to_map</a>(df_clusters).save(<span class="stringliteral">&quot;output/INSERT_NAME.html&quot;</span>)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a1d9da37ce74295e212c2458159132e1a">  297</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#a1d9da37ce74295e212c2458159132e1a">calcule_nb_clusters_par_zone</a>(liste_df, nb_clusters):</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="stringliteral">    TODO</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="stringliteral">    :param liste_df:</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="stringliteral">    :param nb_clusters:</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="stringliteral">    :return:</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    poids_par_zone: np.ndarray = np.zeros(len(liste_df))</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(liste_df)):</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        poids_par_zone[i] = <a class="code" href="namespaceclusterizer__utils.html#aba2719bff914168ef7fd424000278568">clusterizer_utils.calculer_poids_cluster</a>(liste_df[i], <span class="stringliteral">&quot;apet700&quot;</span>)</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    poids_total = np.sum(poids_par_zone)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    nb_par_zone = np.rint((poids_par_zone / poids_total * nb_clusters)).astype(int)</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    nb_par_zone = np.maximum(nb_par_zone, np.ones(len(liste_df), dtype=int))  <span class="comment"># il faut au moins un cluster par zone considérée</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">return</span> nb_par_zone</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a3baf2ddde23e317d27bb6e1234a4a061">  313</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#a3baf2ddde23e317d27bb6e1234a4a061">main_json</a>(rayon: int = 8, secteur_NAF: List[str] = <span class="stringliteral">&#39;&#39;</span>, nb_clusters: int = 50, adresse_map: str = <span class="stringliteral">&quot;output/clusterized_map_seine.html&quot;</span>,</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;              reduce: bool = <span class="keyword">False</span>,</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;              threshold: int = 1000) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="stringliteral">    Fonction principale à exécuter pour successivement ouvrir la DataFrame contenant les données,</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="stringliteral">    nettoyer la DataFrame, filtrer par secteurs NAF, ne garder que les magasins proche du centre de Paris,</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="stringliteral">    séparer par la Seine, clusteriser et sauvegarder dans une carte.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="stringliteral">    La répartition entre les secteurs de la Seine est calculée automatiquement.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="stringliteral">    :param rayon: le rayon (à partir du centre de Paris).</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="stringliteral">    :param secteur_NAF: les secteurs NAF à sélectionner.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral">    :param nb_clusters: le nombre de clusters à calculer.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="stringliteral">    :param adresse_map: l&#39;adresse de la carte en sortie.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="stringliteral">    :param reduce: mettre :code:`True` pour n&#39;utiliser qu&#39;une version allégée des données (plus rapide).</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="stringliteral">    :param threshold: nombre de données utilisées si reduce= :code:`True` </span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="stringliteral">    :return: :code:`None` </span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    t1 = time.time()</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    print(<span class="stringliteral">&quot;Ouverture de la DataFrame...&quot;</span>, end=<span class="stringliteral">&quot;    &quot;</span>)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    df = <a class="code" href="namespaceclusterizer.html#aeec4083b19ab1b2b6b1dece87329556d">nettoyer</a>(pd.read_json(<span class="stringliteral">&quot;../../data/base_sirene_shortened.json&quot;</span>), reduce=reduce, threshold=threshold)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">if</span> secteur_NAF != [<span class="stringliteral">&#39;&#39;</span>] :</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        list_section = []</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">for</span> secteur <span class="keywordflow">in</span> secteur_NAF :</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            list_section = list_section + <a class="code" href="namespace_n_a_f__utils.html#a1fe02847c67bcc048c209dbc79ac0880">NAF_utils.get_NAFs_by_section</a>(secteur).tolist()</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        df = <a class="code" href="namespace_n_a_f__utils.html#a0e7dd8fd0c6ec68d47f461d7e8819da2">NAF_utils.filter_by_naf</a>(df, list_section, <span class="stringliteral">&quot;apet700&quot;</span>)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    t2 = time.time()</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    print(f<span class="stringliteral">&quot;{t2-t1:2.3f} s&quot;</span>)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    t1 = time.time()</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    print(<span class="stringliteral">&quot;On ne garde que les données du centre...&quot;</span>, end=<span class="stringliteral">&quot;    &quot;</span>)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    df = <a class="code" href="namespaceclusterizer__utils.html#ae02c5cdf4a0f5c7987cb6eb76575b39d">clusterizer_utils.filter_nearby_paris</a>(df, radius=rayon, is_dict=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    t2 = time.time()</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    print(f<span class="stringliteral">&quot;{t2-t1:2.3f} s&quot;</span>)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    t1 = time.time()</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    print(<span class="stringliteral">&quot;On sépare par la Seine...&quot;</span>, end=<span class="stringliteral">&quot;    &quot;</span>)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment"># on va avoir au moins 4 zones:</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment"># rive Gauche,</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment"># rive Droite,</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment"># Maisons-Alfort,</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment"># Courbevoie-Asnières</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    nb_zones = 4</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    liste_df = []</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">for</span> no_zone <span class="keywordflow">in</span> range(nb_zones):</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        liste_df.append(</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="comment"># df[numba_rapport_a_la_seine(np.array(df.copy()[&quot;geometry&quot;].apply(lambda x: x[&#39;coordinates&#39;])), no_zone)]</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            df[no_zone == <a class="code" href="namespaceclusterizer.html#a1842efc97d44e8e752733c4d063f523a">rapport_a_la_seine</a>(np.array(df.copy()[<span class="stringliteral">&quot;geometry&quot;</span>].apply(<span class="keyword">lambda</span> x: x[<span class="stringliteral">&#39;coordinates&#39;</span>])))].reset_index(drop=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        )</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment"># print(liste_df[0].head(5))</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment"># input()</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment"># print(&quot;\n\n\n&quot;)</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment"># print(liste_df[0].to_numpy())</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment"># input()</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment"># liste_df = RawArray(pd.DataFrame, nb_zones)</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment"># liste_processes : List[Process] = []</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment"># for i in range(nb_zones):</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">#     liste_processes.append(Process(target=process_rapport_a_la_seine, args= (i, df, liste_df)))</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment"># for i in range(nb_zones):</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">#     liste_processes[i].start()</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment"># for i in range(nb_zones):</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">#     liste_processes[i].join()</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment"># with Pool(nb_zones) as p:</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment">#     liste_df = p.map(map_rapport_a_la_seine, [(i, df) for i in range(nb_zones)])</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    t2 = time.time()</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    print(f<span class="stringliteral">&quot;{t2-t1:2.3f} s&quot;</span>)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    t1 = time.time()</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    print(<span class="stringliteral">&quot;Clusterisation...&quot;</span>, end=<span class="stringliteral">&quot;    &quot;</span>)</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    liste_df_clusters = []</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    nb_clusters_par_zone = <a class="code" href="namespaceclusterizer.html#a1d9da37ce74295e212c2458159132e1a">calcule_nb_clusters_par_zone</a>(liste_df, nb_clusters)</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment"># pprint(nb_clusters_par_zone)</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">for</span> no_zone <span class="keywordflow">in</span> range(nb_zones):</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            liste_df_clusters.append(</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                <a class="code" href="namespaceclusterizer.html#a3af79889960331fc4392936526bc8ad6">clusterize</a>(liste_df[no_zone], nb_clusters_par_zone[no_zone], is_dict=<span class="keyword">True</span>, weight=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            )</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">except</span> ValueError:</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    t2 = time.time()</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    print(f<span class="stringliteral">&quot;{t2-t1:2.3f} s&quot;</span>)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    t1 = time.time()</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    print(<span class="stringliteral">&quot;Génération de la carte et sauvegarde...&quot;</span>, end=<span class="stringliteral">&quot;    &quot;</span>)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    map = <a class="code" href="namespaceclusterizer.html#a3347b353b00237f8b17fd025f019c50f">save_to_map</a>(liste_df_clusters[0][1])</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">for</span> no_zone <span class="keywordflow">in</span> range(1, len(liste_df_clusters)):</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        map = <a class="code" href="namespaceclusterizer.html#a3347b353b00237f8b17fd025f019c50f">save_to_map</a>(liste_df_clusters[no_zone][1], map=map)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    map.save(adresse_map)</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    t2 = time.time()</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    print(f<span class="stringliteral">&quot;{t2-t1:2.3f} s&quot;</span>)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    t1 = time.time()</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    print(<span class="stringliteral">&quot;Terminé !&quot;</span>)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a2a47baec99d0af254595a53d0a496c84">  426</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceclusterizer.html#a2a47baec99d0af254595a53d0a496c84">test_naf</a>():</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="stringliteral">    Fonction interne (utilisée pour vérifier le bon fonctionnement du filtrage par NAF).</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    print(<a class="code" href="namespace_n_a_f__utils.html#a1fe02847c67bcc048c209dbc79ac0880">NAF_utils.get_NAFs_by_section</a>(<span class="stringliteral">&quot;L&quot;</span>))</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment"># On exécute le programme avec la base SIRENE :</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> DEBUG_PLOT:</div>
<div class="line"><a name="l00437"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a38579bf57d0235945ae91a8794fa34d7">  437</a></span>&#160;        <a class="code" href="namespaceclusterizer.html#a3baf2ddde23e317d27bb6e1234a4a061">main_json</a>(reduce=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a5060abb4181ceaa4bdff6d2ae776c6d1">  439</a></span>&#160;        f_seine_nord.plot(couleur=<span class="stringliteral">&quot;black&quot;</span>)</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        f_seine_ouest.plot(couleur=<span class="stringliteral">&quot;purple&quot;</span>)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        f_seine_petit_droite.plot(couleur=<span class="stringliteral">&quot;black&quot;</span>)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        f_seine_petit_gauche.plot(couleur=<span class="stringliteral">&quot;black&quot;</span>)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        f_seine_central.plot(couleur=<span class="stringliteral">&quot;black&quot;</span>)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        f_seine_alfort_1_gauche.plot(couleur=<span class="stringliteral">&quot;black&quot;</span>)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        f_seine_alfort_2_droite.plot(couleur=<span class="stringliteral">&quot;black&quot;</span>)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        f_seine_alfort_3_gauche.plot(couleur=<span class="stringliteral">&quot;black&quot;</span>)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        f_marne.plot(couleur=<span class="stringliteral">&quot;black&quot;</span>)</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        plt.show()</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00451"></a><span class="lineno"><a class="line" href="namespaceclusterizer.html#a8bf5bca9511b93fde174595b5a2d2db4">  451</a></span>&#160;        <a class="code" href="namespaceclusterizer.html#a3baf2ddde23e317d27bb6e1234a4a061">main_json</a>(adresse_map=<span class="stringliteral">&quot;output/clusterized_map_improve_nb_clusters.html&quot;</span>)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="comment"># main_json(reduce = True, adresse_map=&quot;output/clusterized_map_optim_de_cython.html&quot;)</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="comment"># main_json(adresse_map=&quot;output/clusterized_map_IHM.html&quot;)</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="comment"># cProfile.run(&#39;main_json(adresse_map=&quot;output/clusterized_map_optim_de_cython.html&quot;)&#39;)</span></div>
<div class="ttc" id="anamespace_n_a_f__utils_html_a0e7dd8fd0c6ec68d47f461d7e8819da2"><div class="ttname"><a href="namespace_n_a_f__utils.html#a0e7dd8fd0c6ec68d47f461d7e8819da2">NAF_utils.filter_by_naf</a></div><div class="ttdeci">pd.DataFrame filter_by_naf(pd.DataFrame df, List[str] codes_naf, str column_codes)</div><div class="ttdef"><b>Definition:</b> <a href="_n_a_f__utils_8py_source.html#l00115">NAF_utils.py:115</a></div></div>
<div class="ttc" id="anamespace_n_a_f__utils_html_a1fe02847c67bcc048c209dbc79ac0880"><div class="ttname"><a href="namespace_n_a_f__utils.html#a1fe02847c67bcc048c209dbc79ac0880">NAF_utils.get_NAFs_by_section</a></div><div class="ttdeci">Series get_NAFs_by_section(str section)</div><div class="ttdef"><b>Definition:</b> <a href="_n_a_f__utils_8py_source.html#l00085">NAF_utils.py:85</a></div></div>
<div class="ttc" id="anamespaceclusterizer__utils_html_a1a09a2a4d0cb4435e9341da24dde35df"><div class="ttname"><a href="namespaceclusterizer__utils.html#a1a09a2a4d0cb4435e9341da24dde35df">clusterizer_utils.get_infos_clusters_taille</a></div><div class="ttdeci">pd.DataFrame get_infos_clusters_taille(pd.DataFrame df)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer__utils_8py_source.html#l00044">clusterizer_utils.py:44</a></div></div>
<div class="ttc" id="anamespaceclusterizer__utils_html_a4aab52450ec0e5c333c03f2cfa4694e2"><div class="ttname"><a href="namespaceclusterizer__utils.html#a4aab52450ec0e5c333c03f2cfa4694e2">clusterizer_utils.get_coords_from_object</a></div><div class="ttdeci">np.ndarray get_coords_from_object(pd.DataFrame df, str column_geometry=COLUMN_DEFAULT_GEOMETRY_NAME, bool is_dict=False)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer__utils_8py_source.html#l00203">clusterizer_utils.py:203</a></div></div>
<div class="ttc" id="anamespaceclusterizer__utils_html_a5788fa8785e88a80e5a1e584c04ec05b"><div class="ttname"><a href="namespaceclusterizer__utils.html#a5788fa8785e88a80e5a1e584c04ec05b">clusterizer_utils.get_infos_clusters_poids</a></div><div class="ttdeci">pd.DataFrame get_infos_clusters_poids(pd.DataFrame df, str column_naf_code)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer__utils_8py_source.html#l00031">clusterizer_utils.py:31</a></div></div>
<div class="ttc" id="anamespaceclusterizer__utils_html_a67d3497ffce20f00b8670186e255a548"><div class="ttname"><a href="namespaceclusterizer__utils.html#a67d3497ffce20f00b8670186e255a548">clusterizer_utils.get_infos_clusters_enveloppes_convexes</a></div><div class="ttdeci">pd.DataFrame get_infos_clusters_enveloppes_convexes(int k, pd.DataFrame df, str column_geometry=COLUMN_DEFAULT_GEOMETRY_NAME, bool is_dict=False)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer__utils_8py_source.html#l00055">clusterizer_utils.py:55</a></div></div>
<div class="ttc" id="anamespaceclusterizer__utils_html_ab8828a4ec46c57e4c2fbcea7c314bb38"><div class="ttname"><a href="namespaceclusterizer__utils.html#ab8828a4ec46c57e4c2fbcea7c314bb38">clusterizer_utils.swap_xy</a></div><div class="ttdeci">def swap_xy(geom)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer__utils_8py_source.html#l00139">clusterizer_utils.py:139</a></div></div>
<div class="ttc" id="anamespaceclusterizer__utils_html_aba2719bff914168ef7fd424000278568"><div class="ttname"><a href="namespaceclusterizer__utils.html#aba2719bff914168ef7fd424000278568">clusterizer_utils.calculer_poids_cluster</a></div><div class="ttdeci">int calculer_poids_cluster(pd.DataFrame df, str naf_column_name)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer__utils_8py_source.html#l00114">clusterizer_utils.py:114</a></div></div>
<div class="ttc" id="anamespaceclusterizer__utils_html_ae02c5cdf4a0f5c7987cb6eb76575b39d"><div class="ttname"><a href="namespaceclusterizer__utils.html#ae02c5cdf4a0f5c7987cb6eb76575b39d">clusterizer_utils.filter_nearby_paris</a></div><div class="ttdeci">pd.DataFrame filter_nearby_paris(pd.DataFrame df, int radius, str column_geometry=COLUMN_DEFAULT_GEOMETRY_NAME, bool is_dict=False)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer__utils_8py_source.html#l00182">clusterizer_utils.py:182</a></div></div>
<div class="ttc" id="anamespaceclusterizer__utils_html_affa7c2c6862dc269e97b6b0bfa95a4da"><div class="ttname"><a href="namespaceclusterizer__utils.html#affa7c2c6862dc269e97b6b0bfa95a4da">clusterizer_utils.vectorized_calculer_poids_code_NAF</a></div><div class="ttdeci">vectorized_calculer_poids_code_NAF</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer__utils_8py_source.html#l00111">clusterizer_utils.py:111</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_a1842efc97d44e8e752733c4d063f523a"><div class="ttname"><a href="namespaceclusterizer.html#a1842efc97d44e8e752733c4d063f523a">clusterizer.rapport_a_la_seine</a></div><div class="ttdeci">def rapport_a_la_seine(xy)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00052">clusterizer.py:52</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_a1d9da37ce74295e212c2458159132e1a"><div class="ttname"><a href="namespaceclusterizer.html#a1d9da37ce74295e212c2458159132e1a">clusterizer.calcule_nb_clusters_par_zone</a></div><div class="ttdeci">def calcule_nb_clusters_par_zone(liste_df, nb_clusters)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00297">clusterizer.py:297</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_a2a47baec99d0af254595a53d0a496c84"><div class="ttname"><a href="namespaceclusterizer.html#a2a47baec99d0af254595a53d0a496c84">clusterizer.test_naf</a></div><div class="ttdeci">def test_naf()</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00426">clusterizer.py:426</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_a3347b353b00237f8b17fd025f019c50f"><div class="ttname"><a href="namespaceclusterizer.html#a3347b353b00237f8b17fd025f019c50f">clusterizer.save_to_map</a></div><div class="ttdeci">folium.folium.Map save_to_map(pd.DataFrame df_clusters, folium.folium.Map map=None)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00235">clusterizer.py:235</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_a3af79889960331fc4392936526bc8ad6"><div class="ttname"><a href="namespaceclusterizer.html#a3af79889960331fc4392936526bc8ad6">clusterizer.clusterize</a></div><div class="ttdeci">Tuple[pd.DataFrame, pd.DataFrame] clusterize(pd.DataFrame df, int k, str column_geometry=COLUMN_DEFAULT_GEOMETRY_NAME, bool is_dict=False, bool weight=True)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00186">clusterizer.py:186</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_a3baf2ddde23e317d27bb6e1234a4a061"><div class="ttname"><a href="namespaceclusterizer.html#a3baf2ddde23e317d27bb6e1234a4a061">clusterizer.main_json</a></div><div class="ttdeci">None main_json(int rayon=8, List[str] secteur_NAF='', int nb_clusters=50, str adresse_map=&quot;output/clusterized_map_seine.html&quot;, bool reduce=False, int threshold=1000)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00313">clusterizer.py:315</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_a46c1c161d2d1f3c4da2b499b8b4077d8"><div class="ttname"><a href="namespaceclusterizer.html#a46c1c161d2d1f3c4da2b499b8b4077d8">clusterizer.process_rapport_a_la_seine</a></div><div class="ttdeci">None process_rapport_a_la_seine(int no_zone, pd.DataFrame df, Array shared_array)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00144">clusterizer.py:144</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_a786e8ab3d593d24c6ddf8cdb68f93d2b"><div class="ttname"><a href="namespaceclusterizer.html#a786e8ab3d593d24c6ddf8cdb68f93d2b">clusterizer.test_geojson</a></div><div class="ttdeci">def test_geojson()</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00289">clusterizer.py:289</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_ada962bb8f1ec417142e11c0ca8cca63a"><div class="ttname"><a href="namespaceclusterizer.html#ada962bb8f1ec417142e11c0ca8cca63a">clusterizer.map_rapport_a_la_seine</a></div><div class="ttdeci">pd.DataFrame map_rapport_a_la_seine(Tuple[int, pd.DataFrame] args_tuple)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00154">clusterizer.py:154</a></div></div>
<div class="ttc" id="anamespaceclusterizer_html_aeec4083b19ab1b2b6b1dece87329556d"><div class="ttname"><a href="namespaceclusterizer.html#aeec4083b19ab1b2b6b1dece87329556d">clusterizer.nettoyer</a></div><div class="ttdeci">pd.DataFrame nettoyer(pd.DataFrame df, bool reduce=False, int threshold=1000, str column_geometry=COLUMN_DEFAULT_GEOMETRY_NAME)</div><div class="ttdef"><b>Definition:</b> <a href="clusterizer_8py_source.html#l00166">clusterizer.py:166</a></div></div>
<div class="ttc" id="anamespaceseine__data__utils__py_html_a903d42f6fbfa65c2be4ca663bb932caf"><div class="ttname"><a href="namespaceseine__data__utils__py.html#a903d42f6fbfa65c2be4ca663bb932caf">seine_data_utils_py.get_frontieres_utiles</a></div><div class="ttdeci">def get_frontieres_utiles()</div><div class="ttdef"><b>Definition:</b> <a href="seine__data__utils__py_8py_source.html#l00195">seine_data_utils_py.py:195</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Généré par&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
